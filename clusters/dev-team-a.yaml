spec:
  goTemplate: true
  generators:
  - matrix:
      generators:
      - git:
          repoURL: https://github.com/m-gran/devsecops-manifests.git
          revision: HEAD
          # Look for the specific environment files
          files:
          - path: "apps/dev-team-a/*/overlays/*/kustomization.yaml"
  template:
    metadata:
      # .path is now the path to the kustomization file
      # .path.segments allows you to grab the app name and env name
      name: '{{index .path.segments 2}}-{{index .path.segments 4}}'
    spec:
      source:
        repoURL: https://github.com/m-gran/devsecops-manifests.git
        targetRevision: HEAD
        # Use the directory containing the kustomization.yaml
        path: '{{.path.directory}}'